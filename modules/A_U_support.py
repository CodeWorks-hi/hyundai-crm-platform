# -*- coding: utf-8 -*-
import streamlit as st
import re
import os
from huggingface_hub import InferenceClient
from streamlit.components.v1 import html
from modules.A_U_kakao_channel import render_kakao_channel_add_button



# Hugging Face ëª¨ë¸ ì„¤ì •
TEXT_MODEL_ID = "mistralai/Mistral-Small-24B-Instruct-2501"
API_TOKEN = st.secrets.get("gemma_token")

if not API_TOKEN:
    st.error("âŒ Hugging Face API í† í°ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")


# FAQ ë°ì´í„°ì…‹ (ê²€ìƒ‰ ê²°ê³¼ [3] êµ¬ì¡° ë°˜ì˜)
FAQS = [
            {
                "q": "ğŸ  ëŒ€ë¦¬ì  ë°©ë¬¸ ë° ë°©ë¬¸ ìƒë‹´ ì ˆì°¨ê°€ ê¶ê¸ˆí•´ìš”?",
                "a": """**ëŒ€ë¦¬ì  ë°©ë¬¸ ê°€ì´ë“œ**
                - ì§€ì  ê²€ìƒ‰: 'ì§€ì  ì°¾ê¸°' ë©”ë‰´ > ì§€ì—­/ì§€ì ëª… ê²€ìƒ‰
                - ì •ë³´ í™•ì¸: ì§€ë„ ìœ„ì¹˜, ì—°ë½ì²˜, ìš´ì˜ì‹œê°„ ì œê³µ
                - ë°©ë¬¸ ì˜ˆì•½: ì˜¨ë¼ì¸ ì˜ˆì•½ ì‹œìŠ¤í…œ (ë‚ ì§œ/ì‹œê°„ ì„ íƒ)
                """
            },
            {
                "q": "âš¡ ì „ê¸°ì°¨ êµ¬ë§¤ ì‹œ ê³ ë ¤í•  ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                "a": """**ì „ê¸°ì°¨ ì„ íƒ ê°€ì´ë“œ**  
        - ì¶©ì „ ì¸í”„ë¼: ê±°ì£¼ì§€ì—­ ì¶©ì „ì†Œ ë°€ì§‘ë„ í™•ì¸  
        - ì£¼í–‰ ê±°ë¦¬: ì œì¡°ì‚¬ ê³µì¸ ì£¼í–‰ê±°ë¦¬ vs ì‹¤ì œ ì£¼í–‰ ì¡°ê±´ ë¹„êµ  
        - ë³´ì¡°ê¸ˆ: ì •ë¶€/ì§€ìì²´ë³„ ë³´ì¡°ê¸ˆ ì°¨ì´ (ìµœëŒ€ 1,200ë§Œì›)  
        - ë°°í„°ë¦¬ ë³´ì¦: 8ë…„/16ë§Œkm ê¸°ì¤€ ì¶©ì „ ìš©ëŸ‰ 70% ì´ìƒ ë³´ì¥  
        - ì¶©ì „ ì‹œê°„: ê¸‰ì†ì¶©ì „ 30ë¶„(80%) vs ì™„ì†ì¶©ì „ 6ì‹œê°„(100%)
        - ì¹œí™˜ê²½ ë³´ì¡°ê¸ˆ > ì¶©ì „ì†Œ ì„ íƒ > ì¶©ì „ì†Œ í˜„í™© í™•ì¸ ê°€ëŠ¥ """
            },
            {
                "q": "ğŸŒ ì°¨ëŸ‰ì˜ í™˜ê²½ ì˜í–¥ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?",
                "a": """**íƒ„ì†Œ ë°°ì¶œëŸ‰ ë¶„ì„**  
        - ê°€ì†”ë¦° ì°¨ëŸ‰: ì—°ê°„ í‰ê·  2.4í†¤ COâ‚‚ ë°°ì¶œ  
        - ì „ê¸°ì°¨: ë°œì „ ë°©ì‹ì— ë”°ë¼ 0.8~1.2í†¤ (í•œêµ­ ê¸°ì¤€)  
        - ìš°ë¦¬ì˜ ë…¸ë ¥:  
        â–· 2025ë…„ê¹Œì§€ ê³µì¥ ë‚´ ì¬ìƒì—ë„ˆì§€ ì‚¬ìš©ë¥  40% ëª©í‘œ  
        â–· ë°°í„°ë¦¬ ì¬í™œìš© í”„ë¡œê·¸ë¨ ìš´ì˜ (ìˆ˜ëª… ì¢…ë£Œ ë°°í„°ë¦¬ 90% ì¬í™œìš©)"""
            },
            {
                "q": "ğŸ”§ ì •ê¸° ì •ë¹„ ì¼ì •ì€ ì–´ë–»ê²Œ í™•ì¸í•˜ë‚˜ìš”?",
                "a": """**ìŠ¤ë§ˆíŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ**  
        1. ëŒ€ë¦¬ì  ê²€ìƒ‰> 'ì •ë¹„ì†Œ ì°¾ê¸°' ë©”ë‰´ ì ‘ì†  
        2. ì„œë¹„ìŠ¤ ì„¼í„° ì „í™”ë²ˆí˜¸ í™•ì¸ ê°€ëŠ¥
        3. ì£¼í–‰ê±°ë¦¬ ê¸°ë°˜ ë§ì¶¤ ì ê²€ í•­ëª© ì œê³µ  
        4. ì£¼ìš” ê´€ë¦¬ ì£¼ê¸°:  
        - ì—”ì§„ì˜¤ì¼: 15,000km/1ë…„  
        - íƒ€ì´ì–´ ë¡œí…Œì´ì…˜: 10,000km  
        - ë°°í„°ë¦¬ ì ê²€: 30,000km  
        5. í‘¸ì‹œ ì•Œë¦¼ ì„œë¹„ìŠ¤ ì‹ ì²­ ê°€ëŠ¥"""
            },
            {
                "q": "ğŸ›¡ï¸ ì œì¡°ì‚¬ ë³´ì¦ì€ ë¬´ì—‡ì„ í¬í•¨í•˜ë‚˜ìš”?",
                "a": """**ì¢…í•© ë³´ì¦ íŒ¨í‚¤ì§€**  
        - ê¸°ë³¸ ë³´ì¦: 3ë…„/6ë§Œkm (ì°¨ì²´ ë¶€ì‹ 7ë…„)  
        - íŒŒì›ŒíŠ¸ë ˆì¸: 5ë…„/10ë§Œkm  
        - ê³ ì „ì•• ë°°í„°ë¦¬: 8ë…„/16ë§Œkm  
        - ì œì™¸ í•­ëª©:  
        â–· ì†Œëª¨í’ˆ ë¶€í’ˆ (ì™€ì´í¼, ë¸Œë ˆì´í¬ íŒ¨ë“œ ë“±)  
        â–· ì‚¬ê³  ìˆ˜ë¦¬ ì´ë ¥ì´ ìˆëŠ” ê²½ìš°  
        â–· ê¶Œì¥ ì •ë¹„ ë¯¸ì´í–‰ ì‹œ"""
            },
            {
                "q": "ğŸš— ì¤‘ê³ ì°¨ êµ¬ë§¤ ì‹œ ì£¼ì˜ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                "a": """**ì¤‘ê³ ì°¨ ì²´í¬ë¦¬ìŠ¤íŠ¸**  
        - ë°˜ë“œì‹œ í™•ì¸:  
        â‘  ì°¨ëŒ€ë²ˆí˜¸ ì¡°íšŒ (ì‚¬ê³  ì´ë ¥ í™•ì¸)  
        â‘¡ ì—”ì§„ ì˜¤ì¼ ìƒíƒœ ì ê²€  
        3. ì£¼ìš” ê³„ê¸°íŒ ê²½ê³ ë“± ì ê²€  
        - ê¶Œì¥ ì„œë¹„ìŠ¤:  
        â–· ê³µì¸ ì¸ì¦ ì¤‘ê³ ì°¨ í”„ë¡œê·¸ë¨ í™œìš©  
        â–· ì „ë¬¸ ê²€ì‚¬ê´€ ë™ë°˜ ê²€ì°¨  
        â–· ì°¨ëŸ‰ êµ¬ë§¤ ê³„ì•½ì„œ ë°˜ë“œì‹œ ì„œë©´ ì‘ì„±"""
            },
            {
                "q": "ğŸ  ì„œë¹„ìŠ¤ ì„¼í„° ë°©ë¬¸ ì—†ì´ ì •ë¹„ê°€ ê°€ëŠ¥í•œê°€ìš”?",
                "a": """**ëª¨ë°”ì¼ ì„œë¹„ìŠ¤ í”„ë¡œê·¸ë¨**  
        - ê°€ëŠ¥ ì„œë¹„ìŠ¤:  
        â–· ì†Œí”„íŠ¸ì›¨ì–´ ì—…ë°ì´íŠ¸  
        â–· ë°°í„°ë¦¬ ì ê²€  
        â–· íƒ€ì´ì–´ ê³µê¸°ì•• ë³´ì¶©  
        - ì´ìš© ë°©ë²•:  
        â‘  í¬í„¸ì—ì„œ ì„œë¹„ìŠ¤ ì‹ ì²­  
        â‘¡ ê¸°ìˆ ìê°€ ì§€ì • ì¥ì†Œ ë°©ë¬¸  
        â‘¢ ì‹¤ì‹œê°„ ì‘ì—… ì˜ìƒ ì œê³µ  
        - ë¹„ìš©: ê¸°ë³¸ ì¶œë™ë¹„ 3ë§Œì› (ë³´ì¦ë£Œ ë¬´ë£Œ)"""
            },
            {
                "q": "ğŸ“Š ì˜ˆìƒ ìœ ì§€ë¹„ë¥¼ ì–´ë–»ê²Œ ê³„ì‚°í•  ìˆ˜ ìˆë‚˜ìš”?",
                "a": """**ì¢…í•© ìœ ì§€ë¹„ ê³„ì‚°ê¸°**  
        - ê³ ë ¤ ìš”ì†Œ:  
        â–· ì—°ê°„ ì£¼í–‰ê±°ë¦¬  
        â–· ìœ ë¥˜ë¹„/ì „ê¸°ìš”ê¸ˆ  
        â–· ë³´í—˜ë£Œ ë“±ê¸‰  
        â–· ì£¼ì°¨ì¥/í†¨ê²Œì´íŠ¸ ë¹„ìš©  
        - ì œê³µ ê¸°ëŠ¥:  
        â–¶ ì§€ì—­ë³„ í‰ê·  ìœ ì§€ë¹„ ë¹„êµ  
        â–¶ ì¹œí™˜ê²½ì°¨ vs ë‚´ì—°ê¸°ê´€ì°¨ ê²½ì œì„± ë¹„êµ  
        â–¶ 5ë…„ ì´ ì†Œìœ  ë¹„ìš©(TCO) ì‹œë®¬ë ˆì´ì…˜"""
            },
            {
                "q": "ğŸ”Œ ì „ê¸°ì°¨ ì¶©ì „ ì¸í”„ë¼ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?",
                "a": """**ì¶©ì „ ë„¤íŠ¸ì›Œí¬ í˜„í™©**  
        - ì „êµ­ 2,300ê°œ ì¶©ì „ì†Œ ìš´ì˜ 
        - ì¹œí™˜ê²½ ë³´ì¡°ê¸ˆ >  ì¶©ì „ì†Œ ì„ íƒ > ì¶©ì „ì†Œ í˜„í™© í™•ì¸ ê°€ëŠ¥ 
        - ì£¼ìš” ì œíœ´ì²˜:  
        â–· ê³ ì†ë„ë¡œ íœ´ê²Œì†Œ 100% ì„¤ì¹˜  
        â–· ëŒ€í˜• ë§ˆíŠ¸/ì˜í™”ê´€ ì£¼ì°¨ì¥  
        â–· ì£¼ìš” ë„ì‹œ ê³µìš© ì£¼ì°¨ì¥  
        - í™ˆì¶©ì „ê¸° ì§€ì›:  
        â–¶ ì„¤ì¹˜ë¹„ 50% ì§€ì› (ìµœëŒ€ 70ë§Œì›)  
        â–¶ ì•¼ê°„ í• ì¸ ìš”ê¸ˆì œ ì—°ê³„"""
            },
            {
                "q": "ğŸ†˜ ê¸´ê¸‰ ì¶œë™ ì„œë¹„ìŠ¤ëŠ” ì œê³µë˜ë‚˜ìš”?",
                "a": """**24ì‹œê°„ ê¸´ê¸‰ ì§€ì› ì‹œìŠ¤í…œ**  
        - ì§€ì› í•­ëª©:  
        â–· ë°°í„°ë¦¬ ì í”„ ìŠ¤íƒ€íŠ¸  
        â–· íƒ€ì´ì–´ í‘í¬ ìˆ˜ë¦¬  
        â–· ê¸´ê¸‰ ê²¬ì¸ ì„œë¹„ìŠ¤  
        - ì´ìš© ë°©ë²•:  
        â‘  ì „ìš© ì•± 'SOS' ë²„íŠ¼ í´ë¦­  
        â‘¡ ìœ„ì¹˜ ì •ë³´ ìë™ ì „ì†¡ ë£Œ
        â‘¢ í‰ê·  ì¶œë™ ì‹œê°„ 35ë¶„ ì´ë‚´  
        - ë¹„ìš©: ê¸°ë³¸ ë³´ì¦ë£Œ ë¬´ë£Œ"""
            },
            {
                "q": "ğŸ¨ ì°¨ëŸ‰ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜µì…˜ì€ ë¬´ì—‡ì´ ìˆë‚˜ìš”?",
                "a": """**ë§ì¶¤ ì œì‘ í”„ë¡œê·¸ë¨**  
        - ì™¸ì¥: 15ê°€ì§€ ìƒ‰ìƒ + 5ê°€ì§€ íŠ¹ìˆ˜ ë„ì¥  
        - ë‚´ì¥:  
        â–· ì‹œíŠ¸ ì†Œì¬ (ë‚˜íŒŒ ê°€ì£½/ì¹œí™˜ê²½ ì†Œì¬)  
        â–· ê³„ê¸°íŒ ìŠ¤í‚¨ ë³€ê²½  
        â–· ì•°ë¸”ëŸ¼ ì»¤ìŠ¤í…€ ê°ì¸  
        - ì„±ëŠ¥:  
        â–¶ ECU íŠœë‹ (ë§ˆë ¥ 10% í–¥ìƒ)  
        â–¶ ë°°ê¸° ìŒí–¥ ì¡°ì ˆ ì‹œìŠ¤í…œ  
        - ë‚©ê¸°: 6-8ì£¼ ì†Œìš”"""
            }
        ]

# ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
def build_system_prompt():
    """ê²€ìƒ‰ ê²°ê³¼ [2][4] ë°˜ì˜í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±"""
    newline = '\n'  # ê°œí–‰ ë¬¸ì ë³€ìˆ˜í™”
    faq_items = []
    
    try:
        for idx, faq in enumerate(FAQS, 1):
            formatted_answer = faq['a'].replace(newline, f'{newline}   - ')
            faq_items.append(
                f"{idx}. [{faq['q']}]{newline}"
                f"   - {formatted_answer}"
            )
    except KeyError as e:
        st.error(f"FAQ ë°ì´í„° êµ¬ì¡° ì˜¤ë¥˜: {str(e)}")
        return ""

    return f"""
            [ì‹œìŠ¤í…œ ì—­í• ]
            í˜„ëŒ€ìë™ì°¨ ê³ ê°ì„¼í„° AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.
            ì•„ë˜ FAQ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì „ë¬¸ì ì´ê³  ì •í™•í•œ ë‹µë³€ì„ ì œê³µí•´ì£¼ì„¸ìš”.
  

            [FAQ ë°ì´í„°]
            {newline.join(faq_items)}

			[ì‘ë‹µ ê·œì¹™]
			1. FAQ ë‚´ìš© 100% ì¤€ìˆ˜í•˜ì—¬ ë‹µë³€ (ì§€ì‹ ë²”ìœ„ ì™¸ ì§ˆë¬¸ ì‹œ ì „í™”ë²ˆí˜¸ ì•ˆë‚´)
			2. ìˆ«ì/ê¸ˆì•¡ â†’ í•œê¸€ í‘œê¸° (ì˜ˆ: 50 â†’ ì˜¤ì‹­, 1,200ë§Œì› â†’ ì²œì´ë°±ë§Œ ì›)
			3. ì „ë¬¸ ìš©ì–´ ìµœì†Œí™” â†’ ì´ˆë³´ì ì´í•´ ê°€ëŠ¥í•œ ì„¤ëª…
			4. ë§ˆí¬ë‹¤ìš´ ì‚¬ìš© ê¸ˆì§€ â†’ í‰ë¬¸ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ í‘œí˜„
			5. ì°¨ëŸ‰ ëª¨ë¸ëª…ì€ [ë¸Œëœë“œ-ëª¨ë¸-íŠ¸ë¦¼] í˜•ì‹ í‘œê¸° (ì˜ˆ: í˜„ëŒ€-ì•„ì´ì˜¤ë‹‰6-ìŠ¤íƒ ë‹¤ë“œ)
			6. ë¸Œëœë“œ ì´ë¯¸ì§€ì— ë§ëŠ” ì¡´ëŒ“ë§ ì‚¬ìš© (ì˜ˆ: ~í•©ë‹ˆë‹¤, ~ì…ë‹ˆë‹¤)
			7. ëª¨ë¥´ëŠ” ì§ˆë¬¸ ì²˜ë¦¬: "í•´ë‹¹ ì •ë³´ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ê³ ê°ì„¼í„°(02-1234-5678)ë¡œ ë¬¸ì˜ì£¼ì„¸ìš”"
			8. ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ë§Œ ì‘ì„± (ì˜ˆ: "ë„¤, ë§ìŠµë‹ˆë‹¤" â†’ "ë§ìŠµë‹ˆë‹¤")
			9. ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ë§Œ ì‘ì„± (ì˜ˆ: "ì•„ë‹ˆìš”, ì•„ë‹™ë‹ˆë‹¤" â†’ "ì•„ë‹™ë‹ˆë‹¤")
            10. ì•„ë˜ì˜ FAQ í˜•ì‹ìœ¼ë¡œ ë‹µë³€ ì‘ì„±
            "q": " ì„œë¹„ìŠ¤ ì„¼í„° ë°©ë¬¸ ì—†ì´ ì •ë¹„ê°€ ê°€ëŠ¥í•œê°€ìš”?",
            "a": ì•ˆë…•í•˜ì„¸ìš”! ê³ ê°ë‹˜ì˜ í¸ì˜ë¥¼ ìœ„í•´ ë°©ë¬¸ ì •ë¹„ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. 

                    **ë°©ë¬¸ ê°€ëŠ¥ ì„œë¹„ìŠ¤**  
                    âœ” ì†Œí”„íŠ¸ì›¨ì–´ ìµœì‹  ë²„ì „ ì—…ë°ì´íŠ¸  
                    âœ” ê³ ì „ì•• ë°°í„°ë¦¬ ì„±ëŠ¥ ì ê²€  
                    âœ” íƒ€ì´ì–´ ê³µê¸°ì•• ë¬´ë£Œ ë³´ì¶©  

                     **ì´ìš© ë°©ë²•**  
                    1. í¬í„¸ì—ì„œ [ëª¨ë°”ì¼ ì„œë¹„ìŠ¤ ì‹ ì²­] ë©”ë‰´ ì ‘ì†  
                    2. ì›í•˜ëŠ” ë‚ ì§œ/ì‹œê°„ ì„ íƒ í›„ ì‹ ì²­ ì™„ë£Œ  
                    3. ì „ë¬¸ ê¸°ìˆ ìê°€ ì§€ì • ì¥ì†Œë¡œ ë°©ë¬¸  
                    4. ì‹¤ì‹œê°„ ì˜ìƒìœ¼ë¡œ ì‘ì—… ê³¼ì • í™•ì¸  

                    **ë¹„ìš© ì•ˆë‚´**  
                    - ê¸°ë³¸ ì¶œë™ë¹„: 3ë§Œì› (ë³´ì¦ ê¸°ê°„ ë‚´ ë¬´ë£Œ)  
                    - ë¶€í’ˆ êµì²´ ì‹œ ë³„ë„ ë¹„ìš© ë°œìƒ  

                    ì–¸ì œë“ ì§€ í™ˆí˜ì´ì§€ ë˜ëŠ” ê³ ê°ì„¼í„°(1544-1234)ë¡œ ë¬¸ì˜ì£¼ì„¸ìš”!  
                    ê³ ê°ë‹˜ì˜ ì†Œì¤‘í•œ ì‹œê°„ì„ ì•„ê»´ë“œë¦¬ê¸° ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.

                        """

def generate_gemma_response(user_input: str) -> str:
    if not API_TOKEN:
        return "âŒ ì‹œìŠ¤í…œ ì˜¤ë¥˜: ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”"
    try:
        client = InferenceClient(provider="auto", api_key=API_TOKEN)
        completion = client.chat.completions.create(
            model="mistralai/Mistral-Small-3.1-24B-Instruct-2503",
            messages=[
                {
                    "role": "user",
                    "content": [
                        {
                            "type": "text",
                            "text": f"{build_system_prompt()}\n\n[ì§ˆë¬¸]\n{user_input}\n[ë‹µë³€]"
                        }
                    ]
                }
            ],
        )
        return completion.choices[0].message["content"].strip()
    except Exception as e:
        if "401" in str(e):
            return "âš ï¸ ì¸ì¦ ì˜¤ë¥˜: API í† í°ì„ ì¬ë°œê¸‰í•´ì£¼ì„¸ìš”"
        return f"âš ï¸ ì‹œìŠ¤í…œ ì˜¤ë¥˜: {str(e)}"

def clean_response(text: str) -> str:
    """ê²€ìƒ‰ ê²°ê³¼ [1] ë°ì´í„° í´ë Œì§• ê·œì¹™ ì ìš©"""
    text = re.sub(r'\*\*|```', '', text)
    text = re.sub(r'(\d+)ë§Œì›', lambda x: f"{x.group(1)}ë§Œ ì›", text)  # ê¸ˆì•¡ í¬ë§·íŒ…
    return text[:1500].strip()

def support_ui():
    """IGIS í†µí•© UI (ê²€ìƒ‰ ê²°ê³¼ ë°˜ì˜)"""
    # í—¤ë” ì„¹ì…˜ 
    col1, col2 = st.columns([8, 1])  # columns ì¸ìˆ˜ ì¶”ê°€
    
    with col2:
        render_kakao_channel_add_button()
        
    with col1:
        st.markdown("## ê³ ê° ì§€ì› ì„¼í„°")

    # FAQ ì„¹ì…˜
    st.markdown("### â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸")
    for faq in FAQS:
        with st.expander(faq["q"], expanded=False):
            st.markdown(faq["a"].replace('\n', '  \n'))  # ë§ˆí¬ë‹¤ìš´ ê°œí–‰ ì²˜ë¦¬
        
    st.markdown("---")    

    # AI ì±„íŒ… ì¸í„°í˜ì´ìŠ¤
    st.markdown("### ì‹¤ì‹œê°„ AI ìƒë‹´")

    # ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥
    st.markdown("""
                <style>
                    .faq-guide { 
                        background-color: #f0f2f6;
                        padding: 15px;
                        border-radius: 10px;
                        border-left: 4px solid #2A7FFF;
                        margin: 20px 0;
                    }
                </style>
                <div class="faq-guide">
                    <div style="color:#2A7FFF; font-size:18px; margin-bottom:8px;"> ì§ˆë¬¸ ì „ í™•ì¸í•´ì£¼ì„¸ìš”!</div>
                    <div style="color:#333;">
                        <b>ì•„ë˜ FAQì—ì„œ ì›í•˜ëŠ” ë‹µë³€ì„ ë¨¼ì € ì°¾ì•„ë³´ì„¸ìš”</b><br>
                        â€¢ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ì„ ëª¨ì•„ë‘” <span style="color:#2A7FFF;">'â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸'</span> ì„¹ì…˜ í™•ì¸ë¶€íƒë“œë¦½ë‹ˆë‹¤.<br>
                        â€¢ ì´ë¯¸ ì‘ì„±ëœ ë‹µë³€ì„ ë°”íƒ•ìœ¼ë¡œ ë¹ ë¥´ê²Œ ë¬¸ì œ í•´ê²° ê°€ëŠ¥ í•©ë‹ˆë‹¤.
                    </div>
                    <div style="margin-top:10px; font-size:14px; color:#666;">
                        â€» FAQì˜ ì§ˆë¬¸ ë‚´ìš©ì€ ë°”íƒ•ìœ¼ë¡œ í•˜ë‹¨ ì…ë ¥ì°½ì„ ì´ìš©í•´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”ğŸ˜
                    </div>
                </div>
                """, unsafe_allow_html=True)
    
    user_input = st.text_area("ì§ˆë¬¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš” ", placeholder="ì˜ˆ: ëŒ€ë¦¬ì  ë°©ë¬¸ ë° ë°©ë¬¸ ìƒë‹´ ì ˆì°¨ê°€ ê¶ê¸ˆí•´ìš”?", height=100)

    # ì§ˆë¬¸ ê²°ê³¼ ì¶œë ¥ (ë””ìì¸ ê°œì„  ë° q/a ì œê±° í¬í•¨)
    if st.button("ì§ˆë¬¸í•˜ê¸°"):
        if user_input.strip():
            with st.spinner("AI ë¶„ì„ ì¤‘..."):
                response = generate_gemma_response(user_input)
            
            # ì‹œê°ì ìœ¼ë¡œ ì •ë¦¬ëœ ë°•ìŠ¤ í˜•íƒœë¡œ ì¶œë ¥
            st.markdown(f"""
            <div style='border:1px solid #ccc; padding:20px; border-radius:10px; background-color:#f9f9f9; margin-top:20px; line-height:1.6; font-size:15px;'>
                {response}
            </div>
            """, unsafe_allow_html=True)
        else:
            st.warning("ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")

    # ë¶€ê°€ ì •ë³´ ì„¹ì…˜
    st.markdown("---")
    st.markdown("#####  ğŸ“ ì¶”ê°€ ìƒë‹´ ì•ˆë‚´")
    info_cols = st.columns(3)  # 2ê°œ ì»¬ëŸ¼ ìƒì„±
    
    with info_cols[0]:  # ì²« ë²ˆì§¸ ì»¬ëŸ¼
        st.markdown("**ì „í™”**\n 1544-1234\n (í‰ì¼ 10:00~17:00)")
    
    with info_cols[1]:  # ë‘ ë²ˆì§¸ ì»¬ëŸ¼
        st.markdown("**AI ìƒë‹´**\n 24ì‹œê°„ ìƒë‹´ ê°€ëŠ¥\n (ìƒë‹´ì‚¬ ì—°ê²° ì‹œ ëŒ€ê¸°ì‹œê°„ ë°œìƒ)")

    with info_cols[2]:  # ë‘ ë²ˆì§¸ ì»¬ëŸ¼
        st.markdown("**ì´ë©”ì¼**\n schoi1278@gmail.com\n")
        
